


ARM Macro Assembler    Page 1 


    1 00000000         ;-------------------------------------------------------
                       -----------------
    2 00000000         ;GPIO addresses for Port0 and Port1
    3 00000000 E002C000 
                       PINSEL0 EQU              0xE002C000
    4 00000000 E002C004 
                       PINSEL1 EQU              0xE002C004
    5 00000000 E002C014 
                       PINSEL2 EQU              0xE002C014
    6 00000000         
    7 00000000         ;GPIO masks
    8 00000000 30003000 
                       PINSEL1GPIO
                               EQU              0x30003000  ;Mask to set pins 2
                                                            2 and 30 to GPIO
    9 00000000 00000008 
                       PINSEL2GPIO
                               EQU              0x00000008  ;Mask to set pins 1
                                                            .16-1.25 to GPIO
   10 00000000         
   11 00000000         ;Pin direction addresses for Port0 and Port1
   12 00000000 E0028008 
                       IO0DIR  EQU              0xE0028008
   13 00000000 E0028018 
                       IO1DIR  EQU              0xE0028018
   14 00000000         
   15 00000000         ;Pin direction masks
   16 00000000 40400000 
                       IO0DIROUT
                               EQU              0x40400000  ;Mask to set pin di
                                                            rection for Port0
   17 00000000 03FF0000 
                       IO1DIROUT
                               EQU              0x03FF0000  ;Mask to set pin di
                                                            rection for Port1
   18 00000000         
   19 00000000         ;Set or clear data in pins
   20 00000000 E0028004 
                       IO0SET  EQU              0xE0028004
   21 00000000 E0028014 
                       IO1SET  EQU              0xE0028014
   22 00000000 E002800C 
                       IO0CLR  EQU              0xE002800C
   23 00000000 E002801C 
                       IO1CLR  EQU              0xE002801C
   24 00000000         
   25 00000000 E0028000 
                       IO0PIN  EQU              0xE0028000  ;contains pin data 
                                                            for Port0
   26 00000000 E0028010 
                       IO1PIN  EQU              0xE0028010  ;contains pin data 
                                                            for Port1
   27 00000000         
   28 00000000         ;Bit position for LCD pins
   29 00000000 00FF0000 
                       LCD_DATA
                               EQU              0x00FF0000  ;P1.16 - P1.23  => 
                                                            data pins D[0:7]
   30 00000000 01000000 



ARM Macro Assembler    Page 2 


                       LCD_RS  EQU              0x01000000  ;p1.24    => regist
                                                            er select (0 = cmd,
                                                             1 = char)
   31 00000000 02000000 
                       LCD_E   EQU              0x02000000  ;p1.25    => enable
                                                             
   32 00000000 00400000 
                       LCD_RW  EQU              0x00400000  ;P0.22   => read / 
                                                            write 
   33 00000000 40000000 
                       LCD_LIGHT
                               EQU              0x40000000  ;P0.30   => LCD bac
                                                            klight
   34 00000000         
   35 00000000         ;negation for IOXCLEAR 
   36 00000000 BFFFFFFF 
                       NEG_LIGHT
                               EQU              0xBFFFFFFF  ;negative mask for 
                                                            P0.30
   37 00000000 FF00FFFF 
                       NEG_DATA
                               EQU              0xFF00FFFF  ;negative mask for 
                                                            P1.16 - P.23
   38 00000000         
   39 00000000         ;Cursor MASK left most
   40 00000000 00000080 
                       L1ROW   EQU              0x80
   41 00000000 000000C0 
                       L2ROW   EQU              0xC0
   42 00000000         
   43 00000000         ;cursor mask right most 
   44 00000000 0000008F 
                       R1ROW   EQU              0x8F
   45 00000000         ;-------------------------------------------------------
                       -----------------
   46 00000000         
   47 00000000                 IMPORT           DELAY
   48 00000000                 GLOBAL           lcd_subs
   49 00000000         
   50 00000000                 AREA             mycode,CODE,READONLY
   51 00000000                 ENTRY
   52 00000000         
   53 00000000         ;-------------------------------------------------------
                       ---;
   54 00000000         ;Task 1: Call subroutines for LCD display initialization
                          ;
   55 00000000         ;-------------------------------------------------------
                       ---;
   56 00000000         
   57 00000000         lcd_subs
   58 00000000         
   59 00000000         ;set up the pins to serve the LCD
   60 00000000 EB000002        BL               LCD_pins
   61 00000004         
   62 00000004         ;initialize the LCD (wakeup routine)
   63 00000004 EB00001D        BL               LCD_init
   64 00000008         
   65 00000008         ;-------------------------------------------------------
                       ---;



ARM Macro Assembler    Page 3 


   66 00000008         ;Task 2: Display two character strings in first and seco
                       nd ;
   67 00000008         ;        line of the LCD by calling each subroutine.    
                        ; 
   68 00000008         ;-------------------------------------------------------
                       ---;
   69 00000008         
   70 00000008         TASK2
   71 00000008         
   72 00000008         ;Write strings to LCD
   73 00000008 EB00009A        BL               LCD_string
   74 0000000C         
   75 0000000C EA0000BD        B                EXIT
   76 00000010         
   77 00000010         ;-------------------------------------------------------
                       ---;
   78 00000010         ;This subroutine will initialize the pins to work as an 
                       LCD;
   79 00000010         ;-------------------------------------------------------
                       ---;
   80 00000010         
   81 00000010         LCD_pins
   82 00000010         
   83 00000010         ;**Stack stuff
   84 00000010 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
   85 00000014 E10F0000        MRS              r0, CPSR    ;preserve status re
                                                            gister
   86 00000018 E92D0001        STMFD            SP!, {r0}
   87 0000001C         
   88 0000001C         ;Set GPIO for Port0 and Port1
   89 0000001C E59F0304        LDR              r0, =PINSEL1 ;read contents of 
                                                            Port 0
   90 00000020 E5901000        LDR              r1,[r0]
   91 00000024 E59F3300        LDR              r3, =PINSEL1GPIO ;read mask for
                                                             GPIO 
   92 00000028 E1C11003        BIC              r1,r1,r3    ;clear P0.22 and P0
                                                            .30
   93 0000002C E5801000        STR              r1,[r0]
   94 00000030         
   95 00000030 E59F02F8        LDR              r0,=PINSEL2 ;read contents of P
                                                            ort 1
   96 00000034 E3A02000        MOV              r2, #0
   97 00000038 E5802000        STR              r2,[r0]
   98 0000003C         
   99 0000003C         ;Set pin direction for Port0
  100 0000003C E59F02F0        LDR              r0,=IO0DIR  ;read contents of I
                                                            ODIR
  101 00000040 E5901000        LDR              r1,[r0]
  102 00000044 E59F32EC        LDR              r3, =IO0DIROUT
  103 00000048 E1811003        ORR              r1,r1, r3   ;set Port0 pins to 
                                                            output
  104 0000004C E5801000        STR              r1,[r0]
  105 00000050         
  106 00000050         ;Set pin direction for Port1
  107 00000050 E59F02E4        LDR              r0,=IO1DIR
  108 00000054 E5901000        LDR              r1,[r0]
  109 00000058 E59F32E0        LDR              r3, =IO1DIROUT



ARM Macro Assembler    Page 4 


  110 0000005C E1811003        ORR              r1,r1,r3    ;set Port1 pins to 
                                                            output
  111 00000060 E5801000        STR              r1,[r0]
  112 00000064         
  113 00000064         ;Turn on the LCD backlight 
  114 00000064 E3A00101        LDR              r0,=LCD_LIGHT ;set P0.30
  115 00000068 E59F12D4        LDR              r1,=IO0SET
  116 0000006C E5810000        STR              r0,[r1]
  117 00000070         
  118 00000070         ;Stack stuff
  119 00000070 E8BD0001        LDMFD            SP!, {r0}
  120 00000074 E128F000        MSR              CPSR_f, r0
  121 00000078 E8BD5FFF        LDMFD            SP!, {r0 - r12, LR}
  122 0000007C         
  123 0000007C E12FFF1E        BX               LR
  124 00000080         
  125 00000080         ;--------------------------------------------------;
  126 00000080         ;This subroutine will initialize the LCD and wakeup;
  127 00000080         ;--------------------------------------------------;
  128 00000080         
  129 00000080         LCD_init
  130 00000080         
  131 00000080         ;**Stack stuff
  132 00000080 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  133 00000084 E10F1000        MRS              r1, CPSR    ;preserve status re
                                                            gister
  134 00000088 E92D0002        STMFD            SP!, {r1}
  135 0000008C         
  136 0000008C         ;(1) Set E, RS, RW = 0 and wait for 15 ms 
  137 0000008C         
  138 0000008C         ;set RS = 0
  139 0000008C E3A04401        LDR              r4,=LCD_RS
  140 00000090 E59F52B0        LDR              r5,=IO1CLR  ;set P1.24 to zero
  141 00000094 E5854000        STR              r4, [r5]
  142 00000098         
  143 00000098         ;set E = 0
  144 00000098 E3A04402        LDR              r4,=LCD_E
  145 0000009C E59F52A4        LDR              r5,=IO1CLR  ;set P1.25 to zero
  146 000000A0 E5854000        STR              r4, [r5]
  147 000000A4         
  148 000000A4         ;set R/W = 0
  149 000000A4 E3A04501        LDR              r4, =LCD_RW
  150 000000A8 E59F529C        LDR              r5, =IO0CLR ;set P0.22 to zero
  151 000000AC E5854000        STR              r4, [r5]
  152 000000B0         
  153 000000B0         ;Wait for 15 ms
  154 000000B0 E3A00E7D        LDR              r0, =2000   ;delay in increment
                                                            s of 10 us
  155 000000B4 EBFFFFFE        BL               DELAY       ;15e-3 s / 10e-6 s 
                                                            
  156 000000B8         
  157 000000B8         ;(2) Send a command to pins D[7:0] and wait for 4.1 ms
  158 000000B8 E3A00030        MOV              r0, #0x30
  159 000000BC EB00001C        BL               LCD_cmd     ;send wakeup comman
                                                            d
  160 000000C0 E3A00FFA        LDR              r0, =1000   ;delay in increment
                                                            s of 10 us



ARM Macro Assembler    Page 5 


  161 000000C4 EBFFFFFE        BL               DELAY       ;41e-3 s / 10e-6 s
  162 000000C8         
  163 000000C8         ;(3) Send a command to pins and wait 100 us 
  164 000000C8 E3A00030        MOV              r0, #0x30
  165 000000CC EB000018        BL               LCD_cmd     ;send wakeup comman
                                                            d
  166 000000D0 E3A00014        LDR              r0, =20     ;delay in increment
                                                            s of 10 us
  167 000000D4 EBFFFFFE        BL               DELAY       ;100e-6 s / 10e-6 s
                                                            
  168 000000D8         
  169 000000D8         ;(4) Send command 0x30 to pins and wait 4.1 ms
  170 000000D8 E3A00030        MOV              r0, #0x30
  171 000000DC EB000014        BL               LCD_cmd     ;send wakeup comman
                                                            d
  172 000000E0 E3A00FFA        LDR              r0, =1000   ;delay in increment
                                                            s of 10 us
  173 000000E4 EBFFFFFE        BL               DELAY       ;100e-6 s / 10e-6 s
                                                            
  174 000000E8         
  175 000000E8         ;(5) Send 0x38 command to LCD
  176 000000E8 E3A00038        MOV              r0, #0x38
  177 000000EC EB000010        BL               LCD_cmd     ;send function sele
                                                            ct command
  178 000000F0 E59F0258        LDR              r0, =410    ;delay in increment
                                                            s of 10 us
  179 000000F4 EBFFFFFE        BL               DELAY       ;41e-3 s / 10e-6 s
  180 000000F8         
  181 000000F8         ;(6) Send 0x0c command to LCD
  182 000000F8 E3A0000C        MOV              r0, #0x0C
  183 000000FC EB00000C        BL               LCD_cmd     ;send LCD display o
                                                            n control command
  184 00000100 E59F0248        LDR              r0, =410    ;sending command st
                                                            ill needs a delay
  185 00000104 EBFFFFFE        BL               DELAY
  186 00000108         
  187 00000108         ;(7) Send 0x01 command to LCD
  188 00000108 E3A00001        MOV              r0, #0x01
  189 0000010C EB000008        BL               LCD_cmd     ;send clear LCD dis
                                                            play command 
  190 00000110 E59F0238        LDR              r0, =410
  191 00000114 EBFFFFFE        BL               DELAY
  192 00000118         
  193 00000118         ;(8) Send 0x06 command to LCD
  194 00000118 E3A00006        MOV              r0, #0x06
  195 0000011C EB000004        BL               LCD_cmd     ;send entry mode se
                                                            t command 
  196 00000120 E59F0228        LDR              r0, =410
  197 00000124 EBFFFFFE        BL               DELAY
  198 00000128         
  199 00000128         ;**Stack stuff     ;ANOTHER METHOD TO RETURN FROM SUBROU
                       TINE
  200 00000128 E8BD0001        LDMFD            SP!, {r0}
  201 0000012C E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  202 00000130 E8BD9FFF        LDMFD            SP!, {r0 - r12, PC} 
                                                            ;restore registers
  203 00000134         
  204 00000134         ;--------------------------------------------------;



ARM Macro Assembler    Page 6 


  205 00000134         ;This subroutine will send a command to the LCD    ;
  206 00000134         ;--------------------------------------------------;
  207 00000134         
  208 00000134         LCD_cmd
  209 00000134         
  210 00000134         ;**Stack stuff
  211 00000134 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  212 00000138 E10F1000        MRS              r1, CPSR    ;preserve status re
                                                            gister
  213 0000013C E92D0002        STMFD            SP!, {r1}
  214 00000140         
  215 00000140         ;(1) D[7:0] = command (passed from the calling program).
                       
  216 00000140         
  217 00000140 E59F220C        LDR              r2, =IO1PIN ;r2 contains pin da
                                                            ta
  218 00000144         
  219 00000144         ;shift data 
  220 00000144 E1A01800        LSL              r1, r0, #16 ;shift command by 1
                                                            6 bits
  221 00000148         
  222 00000148 E3A048FF        LDR              r4, =LCD_DATA
  223 0000014C E5925000        LDR              r5,[R2]
  224 00000150 E3E068FF        LDR              R6,=NEG_DATA
  225 00000154 E0055006        AND              r5, r5, r6
  226 00000158 E1813005        ORR              r3, r1, r5  ;mask pins D[0:7] w
                                                            ith command data
  227 0000015C E5823000        STR              r3, [r2]    ;store command to p
                                                            in data
  228 00000160         
  229 00000160         ;(2) RS = 0, R/W = 0, and E = 0 ; and wait for at least 
                       6탎.
  230 00000160         
  231 00000160         ;set RS = 0
  232 00000160 E3A04401        LDR              r4,=LCD_RS
  233 00000164 E59F51DC        LDR              r5,=IO1CLR  ;set P1.24 to zero
  234 00000168 E5854000        STR              r4, [r5]
  235 0000016C         
  236 0000016C         ;set E = 0
  237 0000016C E3A04402        LDR              r4,=LCD_E
  238 00000170 E59F51D0        LDR              r5,=IO1CLR  ;set P1.25 to zero
  239 00000174 E5854000        STR              r4, [r5]
  240 00000178         
  241 00000178         ;set R/W = 0
  242 00000178 E3A04501        LDR              r4, =LCD_RW
  243 0000017C E59F51C8        LDR              r5, =IO0CLR ;set P0.22 to zero
  244 00000180 E5854000        STR              r4, [r5]
  245 00000184         
  246 00000184         ;Wait for 6us
  247 00000184 E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  248 00000188 EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  249 0000018C         
  250 0000018C         ;(3)E = 1 ; and wait for at least 6탎.
  251 0000018C         
  252 0000018C         ;set E = 1
  253 0000018C E3A04402        LDR              r4,=LCD_E



ARM Macro Assembler    Page 7 


  254 00000190 E59F51C0        LDR              r5,=IO1SET  ;set P1.25 to one
  255 00000194 E5854000        STR              r4, [r5]
  256 00000198         
  257 00000198         ;Wait for 6us
  258 00000198 E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  259 0000019C EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  260 000001A0         
  261 000001A0         ;(4) E = 0; and wait for at least 40탎.
  262 000001A0         
  263 000001A0         ;set E = 0
  264 000001A0 E3A04402        LDR              r4,=LCD_E
  265 000001A4 E59F519C        LDR              r5,=IO1CLR  ;set P1.25 to zero
  266 000001A8 E5854000        STR              r4, [r5]
  267 000001AC         
  268 000001AC         ;Wait for 40us
  269 000001AC E3A00004        LDR              r0, =4      ;delay in increment
                                                            s of 10 us  
  270 000001B0 EBFFFFFE        BL               DELAY       ;40e-6 s / 10e-6 s
  271 000001B4         
  272 000001B4         ;**Stack stuff
  273 000001B4 E8BD0001        LDMFD            SP!, {r0}
  274 000001B8 E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  275 000001BC E8BD5FFF        LDMFD            SP!, {r0 - r12, LR} 
                                                            ;restore registers
  276 000001C0         
  277 000001C0 E12FFF1E        BX               LR
  278 000001C4         
  279 000001C4         ;--------------------------------------------------;
  280 000001C4         ;This subroutine will send a char to the LCD       ;
  281 000001C4         ;--------------------------------------------------;
  282 000001C4         
  283 000001C4         LCD_char
  284 000001C4         
  285 000001C4         ;**Stack stuff
  286 000001C4 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  287 000001C8 E10F1000        MRS              r1, CPSR    ;preserve status re
                                                            gister
  288 000001CC E92D0002        STMFD            SP!, {r1}
  289 000001D0         
  290 000001D0         ;(1) D[7:0] = command (passed from the calling program).
                       
  291 000001D0         
  292 000001D0 E59F217C        LDR              r2, =IO1PIN ;r2 contains pin da
                                                            ta
  293 000001D4         
  294 000001D4         ;shift data 
  295 000001D4 E1A01800        LSL              r1, r0, #16 ;shift command by 1
                                                            6 bits
  296 000001D8         
  297 000001D8 E3A048FF        LDR              r4, =LCD_DATA
  298 000001DC E5925000        LDR              r5,[R2]
  299 000001E0 E3E068FF        LDR              R6,=NEG_DATA
  300 000001E4 E0055006        AND              r5, r5, r6
  301 000001E8 E1813005        ORR              r3, r1, r5  ;mask pins D[0:7] w
                                                            ith command data



ARM Macro Assembler    Page 8 


  302 000001EC E5823000        STR              r3, [r2]    ;store command to p
                                                            in data
  303 000001F0         
  304 000001F0         ;(2) RS = 1, R/W = 0, and E = 0 ; and wait for at least 
                       6탎.
  305 000001F0         
  306 000001F0         ;set RS = 1   ;sets to char mode
  307 000001F0 E3A04401        LDR              r4,=LCD_RS
  308 000001F4 E59F515C        LDR              r5,=IO1SET  ;set P1.24 to zero
  309 000001F8 E5854000        STR              r4, [r5]
  310 000001FC         
  311 000001FC         ;set E = 0
  312 000001FC E3A04402        LDR              r4,=LCD_E
  313 00000200 E59F5140        LDR              r5,=IO1CLR  ;set P1.25 to zero
  314 00000204 E5854000        STR              r4, [r5]
  315 00000208         
  316 00000208         ;set R/W = 0
  317 00000208 E3A04501        LDR              r4, =LCD_RW
  318 0000020C E59F5138        LDR              r5, =IO0CLR ;set P0.22 to zero
  319 00000210 E5854000        STR              r4, [r5]
  320 00000214         
  321 00000214         ;Wait for 60us
  322 00000214 E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  323 00000218 EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  324 0000021C         
  325 0000021C         ;(3)E = 1 ; and wait for at least 6탎.
  326 0000021C         
  327 0000021C         ;set E = 1
  328 0000021C E3A04402        LDR              r4,=LCD_E
  329 00000220 E59F5130        LDR              r5,=IO1SET  ;set P1.25 to one
  330 00000224 E5854000        STR              r4, [r5]
  331 00000228         
  332 00000228         ;Wait for 60us
  333 00000228 E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  334 0000022C EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  335 00000230         
  336 00000230         ;(4) E = 0; and wait for at least 40탎.
  337 00000230         
  338 00000230         ;set E = 0
  339 00000230 E3A04402        LDR              r4,=LCD_E
  340 00000234 E59F510C        LDR              r5,=IO1CLR  ;set P1.25 to zero
  341 00000238 E5854000        STR              r4, [r5]
  342 0000023C         
  343 0000023C         ;Wait for 40us
  344 0000023C E3A00004        LDR              r0, =4      ;delay in increment
                                                            s of 10 us  
  345 00000240 EBFFFFFE        BL               DELAY       ;40e-6 s / 10e-6 s
  346 00000244         
  347 00000244         ;**Stack stuff
  348 00000244 E8BD0001        LDMFD            SP!, {r0}
  349 00000248 E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  350 0000024C E8BD5FFF        LDMFD            SP!, {r0 - r12, LR} 
                                                            ;restore registers
  351 00000250         
  352 00000250 E12FFF1E        BX               LR
  353 00000254         



ARM Macro Assembler    Page 9 


  354 00000254         ;--------------------------------------------------;
  355 00000254         ;This subroutine will clear the LCD          ;
  356 00000254         ;--------------------------------------------------;
  357 00000254         
  358 00000254         LCD_clear
  359 00000254         
  360 00000254         ;**Stack stuff
  361 00000254 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  362 00000258 E10F0000        MRS              r0, CPSR    ;preserve status re
                                                            gister
  363 0000025C E92D0001        STMFD            SP!, {r0}
  364 00000260         
  365 00000260         ;Call clear command 
  366 00000260 E3A00001        MOV              r0, #0x01
  367 00000264 EBFFFFB2        BL               LCD_cmd
  368 00000268         
  369 00000268         ;**Stack stuff
  370 00000268 E8BD0001        LDMFD            SP!, {r0}
  371 0000026C E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  372 00000270 E8BD5FFF        LDMFD            SP!, {r0 - r12, LR} 
                                                            ;restore registers
  373 00000274         
  374 00000274 E12FFF1E        BX               LR
  375 00000278         
  376 00000278         ;--------------------------------------------------;
  377 00000278         ;This subroutine will send a string to the LCD    ;
  378 00000278         ;--------------------------------------------------;
  379 00000278         
  380 00000278         LCD_string
  381 00000278         
  382 00000278         ;**Stack stuff
  383 00000278 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  384 0000027C E10F0000        MRS              r0, CPSR    ;preserve status re
                                                            gister
  385 00000280 E92D0001        STMFD            SP!, {r0}
  386 00000284         
  387 00000284         ;initialize for row 1
  388 00000284         ;ADDRESS OF LCD AND STRING TABLE
  389 00000284         
  390 00000284 E3A01080        LDR              R1, =L1ROW  ;index row 2
  391 00000288 E3A02000        MOV              R2, #0      ;index for string (
                                                            character position)
                                                             
  392 0000028C E28F3078        ADR              R3, test_string1
  393 00000290         
  394 00000290         ROW1
  395 00000290         ;Fetch first cursor position 
  396 00000290 E1A00001        MOV              r0, r1
  397 00000294 EBFFFFA6        BL               LCD_cmd
  398 00000298         
  399 00000298         ;Update index after command is called
  400 00000298 E2811001        ADD              R1, r1, #1
  401 0000029C         
  402 0000029C         ;Grab char from string



ARM Macro Assembler    Page 10 


  403 0000029C E7D20003        LDRB             r0, [r2, r3] ;fetch current cha
                                                            racter
  404 000002A0 E0100000        ANDS             R0,R0,R0    ;check for end of s
                                                            tring
  405 000002A4 0A000002        BEQ              NEXTROW     ;If end of string i
                                                            s reached, move to 
                                                            next row
  406 000002A8 EBFFFFC5        BL               LCD_char    ;call char command
  407 000002AC         
  408 000002AC E2822001        ADD              r2, r2, #1  ;fetch next charact
                                                            er of string
  409 000002B0         
  410 000002B0 EAFFFFF6        B                ROW1
  411 000002B4         
  412 000002B4         NEXTROW
  413 000002B4         
  414 000002B4         ;initialize for row 2
  415 000002B4         ;ADDRESS OF LCD AND STRING TABLE
  416 000002B4         
  417 000002B4 E3A010C0        LDR              R1, =L2ROW  ;index of cursor po
                                                            sition
  418 000002B8 E3A02000        MOV              R2, #0      ;index for string (
                                                            character position)
                                                            
  419 000002BC E28F3055        ADR              R3, test_string2
  420 000002C0         
  421 000002C0         ROW2
  422 000002C0         ;Fetch first cursor position 
  423 000002C0 E1A00001        MOV              r0, r1
  424 000002C4 EBFFFF9A        BL               LCD_cmd
  425 000002C8         
  426 000002C8         ;Update index after command is called
  427 000002C8 E2811001        ADD              R1, r1, #1
  428 000002CC         
  429 000002CC         ;Same process as row1
  430 000002CC E7D20003        LDRB             r0, [r2, r3]
  431 000002D0 E0100000        ANDS             R0,R0,R0
  432 000002D4 0A000002        BEQ              SHIFT
  433 000002D8 EBFFFFB9        BL               LCD_char
  434 000002DC         
  435 000002DC E2822001        ADD              r2, r2, #1  ;fetch next charact
                                                            er of string
  436 000002E0         
  437 000002E0 EAFFFFF6        B                ROW2
  438 000002E4         
  439 000002E4         ;-------------------------------------------------------
                       --------;
  440 000002E4         ;Task 3: Generate a rotating character string from right
                        to left;
  441 000002E4         ;-------------------------------------------------------
                       --------;
  442 000002E4         
  443 000002E4         SHIFT
  444 000002E4         
  445 000002E4 E3A00018        MOV              R0, #0x18
  446 000002E8 EBFFFF91        BL               LCD_cmd
  447 000002EC         
  448 000002EC E59F0068        LDR              R0, =0x2510
  449 000002F0 EBFFFFFE        BL               DELAY



ARM Macro Assembler    Page 11 


  450 000002F4         
  451 000002F4 EAFFFFFA        B                SHIFT
  452 000002F8         
  453 000002F8         DONE
  454 000002F8         
  455 000002F8         ;**Stack stuff
  456 000002F8 E8BD0001        LDMFD            SP!, {r0}
  457 000002FC E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  458 00000300 E8BD5FFF        LDMFD            SP!, {r0 - r12, LR} 
                                                            ;restore registers
  459 00000304         
  460 00000304 E12FFF1E        BX               LR
  461 00000308         
  462 00000308         EXIT
  463 00000308         
  464 00000308 EAFFFFFE 
                       stop    B                stop
  465 0000030C         
  466 0000030C 48 65 6C 
              6C 6F 20 
              57 6F 72 
              6C 64 2E 
              00       test_string1
                               DCB              "Hello World.", 0
  467 00000319 49 74 27 
              73 20 41 
              6C 69 76 
              65 21 00 test_string2
                               DCB              "It's Alive!", 0
  468 00000325 00 00 00        ALIGN
  469 00000328         
  470 00000328                 END
              E002C004 
              30003000 
              E002C014 
              E0028008 
              40400000 
              E0028018 
              03FF0000 
              E0028004 
              E002801C 
              E002800C 
              0000019A 
              E0028010 
              E0028014 
              00002510 
Command Line: --debug --xref --diag_suppress=9931 --apcs=interwork --depend=.\o
bjects\lab9.d -o.\objects\lab9.o -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMS
IS\Include -IC:\Keil_v5\ARM\INC\Philips --predefine="__EVAL SETA 1" --predefine
="__UVISION_VERSION SETA 524" --list=.\listings\lab9.lst lab9.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

DONE 000002F8

Symbol: DONE
   Definitions
      At line 453 in file lab9.s
   Uses
      None
Comment: DONE unused
EXIT 00000308

Symbol: EXIT
   Definitions
      At line 462 in file lab9.s
   Uses
      At line 75 in file lab9.s
Comment: EXIT used once
LCD_char 000001C4

Symbol: LCD_char
   Definitions
      At line 283 in file lab9.s
   Uses
      At line 406 in file lab9.s
      At line 433 in file lab9.s

LCD_clear 00000254

Symbol: LCD_clear
   Definitions
      At line 358 in file lab9.s
   Uses
      None
Comment: LCD_clear unused
LCD_cmd 00000134

Symbol: LCD_cmd
   Definitions
      At line 208 in file lab9.s
   Uses
      At line 159 in file lab9.s
      At line 165 in file lab9.s
      At line 171 in file lab9.s
      At line 177 in file lab9.s
      At line 183 in file lab9.s
      At line 189 in file lab9.s
      At line 195 in file lab9.s
      At line 367 in file lab9.s
      At line 397 in file lab9.s
      At line 424 in file lab9.s
      At line 446 in file lab9.s

LCD_init 00000080

Symbol: LCD_init
   Definitions
      At line 129 in file lab9.s
   Uses
      At line 63 in file lab9.s
Comment: LCD_init used once



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

LCD_pins 00000010

Symbol: LCD_pins
   Definitions
      At line 81 in file lab9.s
   Uses
      At line 60 in file lab9.s
Comment: LCD_pins used once
LCD_string 00000278

Symbol: LCD_string
   Definitions
      At line 380 in file lab9.s
   Uses
      At line 73 in file lab9.s
Comment: LCD_string used once
NEXTROW 000002B4

Symbol: NEXTROW
   Definitions
      At line 412 in file lab9.s
   Uses
      At line 405 in file lab9.s
Comment: NEXTROW used once
ROW1 00000290

Symbol: ROW1
   Definitions
      At line 394 in file lab9.s
   Uses
      At line 410 in file lab9.s
Comment: ROW1 used once
ROW2 000002C0

Symbol: ROW2
   Definitions
      At line 421 in file lab9.s
   Uses
      At line 437 in file lab9.s
Comment: ROW2 used once
SHIFT 000002E4

Symbol: SHIFT
   Definitions
      At line 443 in file lab9.s
   Uses
      At line 432 in file lab9.s
      At line 451 in file lab9.s

TASK2 00000008

Symbol: TASK2
   Definitions
      At line 70 in file lab9.s
   Uses
      None
Comment: TASK2 unused
lcd_subs 00000000




ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Relocatable symbols

Symbol: lcd_subs
   Definitions
      At line 57 in file lab9.s
   Uses
      At line 48 in file lab9.s
Comment: lcd_subs used once
mycode 00000000

Symbol: mycode
   Definitions
      At line 50 in file lab9.s
   Uses
      None
Comment: mycode unused
stop 00000308

Symbol: stop
   Definitions
      At line 464 in file lab9.s
   Uses
      At line 464 in file lab9.s
Comment: stop used once
test_string1 0000030C

Symbol: test_string1
   Definitions
      At line 466 in file lab9.s
   Uses
      At line 392 in file lab9.s
Comment: test_string1 used once
test_string2 00000319

Symbol: test_string2
   Definitions
      At line 467 in file lab9.s
   Uses
      At line 419 in file lab9.s
Comment: test_string2 used once
18 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

IO0CLR E002800C

Symbol: IO0CLR
   Definitions
      At line 22 in file lab9.s
   Uses
      At line 150 in file lab9.s
      At line 243 in file lab9.s
      At line 318 in file lab9.s

IO0DIR E0028008

Symbol: IO0DIR
   Definitions
      At line 12 in file lab9.s
   Uses
      At line 100 in file lab9.s
Comment: IO0DIR used once
IO0DIROUT 40400000

Symbol: IO0DIROUT
   Definitions
      At line 16 in file lab9.s
   Uses
      At line 102 in file lab9.s
Comment: IO0DIROUT used once
IO0PIN E0028000

Symbol: IO0PIN
   Definitions
      At line 25 in file lab9.s
   Uses
      None
Comment: IO0PIN unused
IO0SET E0028004

Symbol: IO0SET
   Definitions
      At line 20 in file lab9.s
   Uses
      At line 115 in file lab9.s
Comment: IO0SET used once
IO1CLR E002801C

Symbol: IO1CLR
   Definitions
      At line 23 in file lab9.s
   Uses
      At line 140 in file lab9.s
      At line 145 in file lab9.s
      At line 233 in file lab9.s
      At line 238 in file lab9.s
      At line 265 in file lab9.s
      At line 313 in file lab9.s
      At line 340 in file lab9.s

IO1DIR E0028018

Symbol: IO1DIR



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 13 in file lab9.s
   Uses
      At line 107 in file lab9.s
Comment: IO1DIR used once
IO1DIROUT 03FF0000

Symbol: IO1DIROUT
   Definitions
      At line 17 in file lab9.s
   Uses
      At line 109 in file lab9.s
Comment: IO1DIROUT used once
IO1PIN E0028010

Symbol: IO1PIN
   Definitions
      At line 26 in file lab9.s
   Uses
      At line 217 in file lab9.s
      At line 292 in file lab9.s

IO1SET E0028014

Symbol: IO1SET
   Definitions
      At line 21 in file lab9.s
   Uses
      At line 254 in file lab9.s
      At line 308 in file lab9.s
      At line 329 in file lab9.s

L1ROW 00000080

Symbol: L1ROW
   Definitions
      At line 40 in file lab9.s
   Uses
      At line 390 in file lab9.s
Comment: L1ROW used once
L2ROW 000000C0

Symbol: L2ROW
   Definitions
      At line 41 in file lab9.s
   Uses
      At line 417 in file lab9.s
Comment: L2ROW used once
LCD_DATA 00FF0000

Symbol: LCD_DATA
   Definitions
      At line 29 in file lab9.s
   Uses
      At line 222 in file lab9.s
      At line 297 in file lab9.s

LCD_E 02000000




ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

Symbol: LCD_E
   Definitions
      At line 31 in file lab9.s
   Uses
      At line 144 in file lab9.s
      At line 237 in file lab9.s
      At line 253 in file lab9.s
      At line 264 in file lab9.s
      At line 312 in file lab9.s
      At line 328 in file lab9.s
      At line 339 in file lab9.s

LCD_LIGHT 40000000

Symbol: LCD_LIGHT
   Definitions
      At line 33 in file lab9.s
   Uses
      At line 114 in file lab9.s
Comment: LCD_LIGHT used once
LCD_RS 01000000

Symbol: LCD_RS
   Definitions
      At line 30 in file lab9.s
   Uses
      At line 139 in file lab9.s
      At line 232 in file lab9.s
      At line 307 in file lab9.s

LCD_RW 00400000

Symbol: LCD_RW
   Definitions
      At line 32 in file lab9.s
   Uses
      At line 149 in file lab9.s
      At line 242 in file lab9.s
      At line 317 in file lab9.s

NEG_DATA FF00FFFF

Symbol: NEG_DATA
   Definitions
      At line 37 in file lab9.s
   Uses
      At line 224 in file lab9.s
      At line 299 in file lab9.s

NEG_LIGHT BFFFFFFF

Symbol: NEG_LIGHT
   Definitions
      At line 36 in file lab9.s
   Uses
      None
Comment: NEG_LIGHT unused
PINSEL0 E002C000




ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Absolute symbols

Symbol: PINSEL0
   Definitions
      At line 3 in file lab9.s
   Uses
      None
Comment: PINSEL0 unused
PINSEL1 E002C004

Symbol: PINSEL1
   Definitions
      At line 4 in file lab9.s
   Uses
      At line 89 in file lab9.s
Comment: PINSEL1 used once
PINSEL1GPIO 30003000

Symbol: PINSEL1GPIO
   Definitions
      At line 8 in file lab9.s
   Uses
      At line 91 in file lab9.s
Comment: PINSEL1GPIO used once
PINSEL2 E002C014

Symbol: PINSEL2
   Definitions
      At line 5 in file lab9.s
   Uses
      At line 95 in file lab9.s
Comment: PINSEL2 used once
PINSEL2GPIO 00000008

Symbol: PINSEL2GPIO
   Definitions
      At line 9 in file lab9.s
   Uses
      None
Comment: PINSEL2GPIO unused
R1ROW 0000008F

Symbol: R1ROW
   Definitions
      At line 44 in file lab9.s
   Uses
      None
Comment: R1ROW unused
25 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

DELAY 00000000

Symbol: DELAY
   Definitions
      At line 47 in file lab9.s
   Uses
      At line 155 in file lab9.s
      At line 161 in file lab9.s
      At line 167 in file lab9.s
      At line 173 in file lab9.s
      At line 179 in file lab9.s
      At line 185 in file lab9.s
      At line 191 in file lab9.s
      At line 197 in file lab9.s
      At line 248 in file lab9.s
      At line 259 in file lab9.s
      At line 270 in file lab9.s
      At line 323 in file lab9.s
      At line 334 in file lab9.s
      At line 345 in file lab9.s
      At line 449 in file lab9.s

1 symbol
378 symbols in table
