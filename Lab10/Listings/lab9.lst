


ARM Macro Assembler    Page 1 


    1 00000000         ;-------------------------------------------------------
                       -----------------
    2 00000000         ;GPIO addresses for Port0 and Port1
    3 00000000 E002C000 
                       PINSEL0 EQU              0xE002C000
    4 00000000 E002C004 
                       PINSEL1 EQU              0xE002C004
    5 00000000 E002C014 
                       PINSEL2 EQU              0xE002C014
    6 00000000         
    7 00000000         ;GPIO masks
    8 00000000 30003000 
                       PINSEL1GPIO
                               EQU              0x30003000  ;Mask to set pins 2
                                                            2 and 30 to GPIO
    9 00000000 00000008 
                       PINSEL2GPIO
                               EQU              0x00000008  ;Mask to set pins 1
                                                            .16-1.25 to GPIO
   10 00000000         
   11 00000000         ;Pin direction addresses for Port0 and Port1
   12 00000000 E0028008 
                       IO0DIR  EQU              0xE0028008
   13 00000000 E0028018 
                       IO1DIR  EQU              0xE0028018
   14 00000000         
   15 00000000         ;Pin direction masks
   16 00000000 40400000 
                       IO0DIROUT
                               EQU              0x40400000  ;Mask to set pin di
                                                            rection for Port0
   17 00000000 03FF0000 
                       IO1DIROUT
                               EQU              0x03FF0000  ;Mask to set pin di
                                                            rection for Port1
   18 00000000         
   19 00000000         ;Set or clear data in pins
   20 00000000 E0028004 
                       IO0SET  EQU              0xE0028004
   21 00000000 E0028014 
                       IO1SET  EQU              0xE0028014
   22 00000000 E002800C 
                       IO0CLR  EQU              0xE002800C
   23 00000000 E002801C 
                       IO1CLR  EQU              0xE002801C
   24 00000000         
   25 00000000 E0028000 
                       IO0PIN  EQU              0xE0028000  ;contains pin data 
                                                            for Port0
   26 00000000 E0028010 
                       IO1PIN  EQU              0xE0028010  ;contains pin data 
                                                            for Port1
   27 00000000         
   28 00000000         ;Bit position for LCD pins
   29 00000000 00FF0000 
                       LCD_DATA
                               EQU              0x00FF0000  ;P1.16 - P1.23  => 
                                                            data pins D[0:7]
   30 00000000 01000000 



ARM Macro Assembler    Page 2 


                       LCD_RS  EQU              0x01000000  ;p1.24    => regist
                                                            er select (0 = cmd,
                                                             1 = char)
   31 00000000 02000000 
                       LCD_E   EQU              0x02000000  ;p1.25    => enable
                                                             
   32 00000000 00400000 
                       LCD_RW  EQU              0x00400000  ;P0.22   => read / 
                                                            write 
   33 00000000 40000000 
                       LCD_LIGHT
                               EQU              0x40000000  ;P0.30   => LCD bac
                                                            klight
   34 00000000         
   35 00000000         ;negation for IOXCLEAR 
   36 00000000 BFFFFFFF 
                       NEG_LIGHT
                               EQU              0xBFFFFFFF  ;negative mask for 
                                                            P0.30
   37 00000000 FF00FFFF 
                       NEG_DATA
                               EQU              0xFF00FFFF  ;negative mask for 
                                                            P1.16 - P.23
   38 00000000         
   39 00000000         ;Cursor MASK left most
   40 00000000 00000080 
                       L1ROW   EQU              0x80
   41 00000000 000000C0 
                       L2ROW   EQU              0xC0
   42 00000000         
   43 00000000         ;cursor mask right most 
   44 00000000 0000008F 
                       R1ROW   EQU              0x8F
   45 00000000         ;-------------------------------------------------------
                       -----------------
   46 00000000         
   47 00000000                 IMPORT           DELAY
   48 00000000                 GLOBAL           lcd_subs
   49 00000000                 AREA             mycode,CODE,READONLY
   50 00000000                 ENTRY
   51 00000000         
   52 00000000         ;-------------------------------------------------------
                       ---;
   53 00000000         ;Task 1: Call subroutines for LCD display initialization
                          ;
   54 00000000         ;-------------------------------------------------------
                       ---;
   55 00000000         
   56 00000000         lcd_subs
   57 00000000         
   58 00000000         ;**Stack stuff
   59 00000000 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
   60 00000004 E10F0000        MRS              r0, CPSR    ;preserve status re
                                                            gister
   61 00000008 E92D0001        STMFD            SP!, {r0}
   62 0000000C         
   63 0000000C         ;set up the pins to serve the LCD



ARM Macro Assembler    Page 3 


   64 0000000C EB000004        BL               LCD_pins
   65 00000010         
   66 00000010         ;initialize the LCD (wakeup routine)
   67 00000010 EB00001F        BL               LCD_init
   68 00000014         
   69 00000014 EB00009C        BL               LCD_string
   70 00000018         
   71 00000018         ;**Stack stuff
   72 00000018 E8BD0001        LDMFD            SP!, {r0}
   73 0000001C E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
   74 00000020 E8BD9FFF        LDMFD            SP!, {r0 - r12, PC} 
                                                            ;restore registers
   75 00000024         
   76 00000024         ;-------------------------------------------------------
                       ---;
   77 00000024         ;This subroutine will initialize the pins to work as an 
                       LCD;
   78 00000024         ;-------------------------------------------------------
                       ---;
   79 00000024         
   80 00000024         LCD_pins
   81 00000024         
   82 00000024         ;**Stack stuff
   83 00000024 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
   84 00000028 E10F0000        MRS              r0, CPSR    ;preserve status re
                                                            gister
   85 0000002C E92D0001        STMFD            SP!, {r0}
   86 00000030         
   87 00000030         ;Set GPIO for Port0 and Port1
   88 00000030 E59F02E8        LDR              r0, =PINSEL1 ;read contents of 
                                                            Port 0
   89 00000034 E5901000        LDR              r1,[r0]
   90 00000038 E59F32E4        LDR              r3, =PINSEL1GPIO ;read mask for
                                                             GPIO 
   91 0000003C E1C11003        BIC              r1,r1,r3    ;clear P0.22 and P0
                                                            .30
   92 00000040 E5801000        STR              r1,[r0]
   93 00000044         
   94 00000044 E59F02DC        LDR              r0,=PINSEL2 ;read contents of P
                                                            ort 1
   95 00000048 E3A02000        MOV              r2, #0
   96 0000004C E5802000        STR              r2,[r0]
   97 00000050         
   98 00000050         ;Set pin direction for Port0
   99 00000050 E59F02D4        LDR              r0,=IO0DIR  ;read contents of I
                                                            ODIR
  100 00000054 E5901000        LDR              r1,[r0]
  101 00000058 E59F32D0        LDR              r3, =IO0DIROUT
  102 0000005C E1811003        ORR              r1,r1, r3   ;set Port0 pins to 
                                                            output
  103 00000060 E5801000        STR              r1,[r0]
  104 00000064         
  105 00000064         ;Set pin direction for Port1
  106 00000064 E59F02C8        LDR              r0,=IO1DIR
  107 00000068 E5901000        LDR              r1,[r0]
  108 0000006C E59F32C4        LDR              r3, =IO1DIROUT



ARM Macro Assembler    Page 4 


  109 00000070 E1811003        ORR              r1,r1,r3    ;set Port1 pins to 
                                                            output
  110 00000074 E5801000        STR              r1,[r0]
  111 00000078         
  112 00000078         ;Turn on the LCD backlight 
  113 00000078 E3A00101        LDR              r0,=LCD_LIGHT ;set P0.30
  114 0000007C E59F12B8        LDR              r1,=IO0SET
  115 00000080 E5810000        STR              r0,[r1]
  116 00000084         
  117 00000084         ;Stack stuff
  118 00000084 E8BD0001        LDMFD            SP!, {r0}
  119 00000088 E128F000        MSR              CPSR_f, r0
  120 0000008C E8BD5FFF        LDMFD            SP!, {r0 - r12, LR}
  121 00000090         
  122 00000090 E12FFF1E        BX               LR
  123 00000094         
  124 00000094         ;--------------------------------------------------;
  125 00000094         ;This subroutine will initialize the LCD and wakeup;
  126 00000094         ;--------------------------------------------------;
  127 00000094         
  128 00000094         LCD_init
  129 00000094         
  130 00000094         ;**Stack stuff
  131 00000094 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  132 00000098 E10F1000        MRS              r1, CPSR    ;preserve status re
                                                            gister
  133 0000009C E92D0002        STMFD            SP!, {r1}
  134 000000A0         
  135 000000A0         ;(1) Set E, RS, RW = 0 and wait for 15 ms 
  136 000000A0         
  137 000000A0         ;set RS = 0
  138 000000A0 E3A04401        LDR              r4,=LCD_RS
  139 000000A4 E59F5294        LDR              r5,=IO1CLR  ;set P1.24 to zero
  140 000000A8 E5854000        STR              r4, [r5]
  141 000000AC         
  142 000000AC         ;set E = 0
  143 000000AC E3A04402        LDR              r4,=LCD_E
  144 000000B0 E59F5288        LDR              r5,=IO1CLR  ;set P1.25 to zero
  145 000000B4 E5854000        STR              r4, [r5]
  146 000000B8         
  147 000000B8         ;set R/W = 0
  148 000000B8 E3A04501        LDR              r4, =LCD_RW
  149 000000BC E59F5280        LDR              r5, =IO0CLR ;set P0.22 to zero
  150 000000C0 E5854000        STR              r4, [r5]
  151 000000C4         
  152 000000C4         ;Wait for 15 ms
  153 000000C4 E3A00E7D        LDR              r0, =2000   ;delay in increment
                                                            s of 10 us
  154 000000C8 EBFFFFFE        BL               DELAY       ;15e-3 s / 10e-6 s 
                                                            
  155 000000CC         
  156 000000CC         ;(2) Send a command to pins D[7:0] and wait for 4.1 ms
  157 000000CC E3A00030        MOV              r0, #0x30
  158 000000D0 EB00001C        BL               LCD_cmd     ;send wakeup comman
                                                            d
  159 000000D4 E3A00FFA        LDR              r0, =1000   ;delay in increment
                                                            s of 10 us



ARM Macro Assembler    Page 5 


  160 000000D8 EBFFFFFE        BL               DELAY       ;41e-3 s / 10e-6 s
  161 000000DC         
  162 000000DC         ;(3) Send a command to pins and wait 100 us 
  163 000000DC E3A00030        MOV              r0, #0x30
  164 000000E0 EB000018        BL               LCD_cmd     ;send wakeup comman
                                                            d
  165 000000E4 E3A00014        LDR              r0, =20     ;delay in increment
                                                            s of 10 us
  166 000000E8 EBFFFFFE        BL               DELAY       ;100e-6 s / 10e-6 s
                                                            
  167 000000EC         
  168 000000EC         ;(4) Send command 0x30 to pins and wait 4.1 ms
  169 000000EC E3A00030        MOV              r0, #0x30
  170 000000F0 EB000014        BL               LCD_cmd     ;send wakeup comman
                                                            d
  171 000000F4 E3A00FFA        LDR              r0, =1000   ;delay in increment
                                                            s of 10 us
  172 000000F8 EBFFFFFE        BL               DELAY       ;100e-6 s / 10e-6 s
                                                            
  173 000000FC         
  174 000000FC         ;(5) Send 0x38 command to LCD
  175 000000FC E3A00038        MOV              r0, #0x38
  176 00000100 EB000010        BL               LCD_cmd     ;send function sele
                                                            ct command
  177 00000104 E59F023C        LDR              r0, =410    ;delay in increment
                                                            s of 10 us
  178 00000108 EBFFFFFE        BL               DELAY       ;41e-3 s / 10e-6 s
  179 0000010C         
  180 0000010C         ;(6) Send 0x0c command to LCD
  181 0000010C E3A0000C        MOV              r0, #0x0C
  182 00000110 EB00000C        BL               LCD_cmd     ;send LCD display o
                                                            n control command
  183 00000114 E59F022C        LDR              r0, =410    ;sending command st
                                                            ill needs a delay
  184 00000118 EBFFFFFE        BL               DELAY
  185 0000011C         
  186 0000011C         ;(7) Send 0x01 command to LCD
  187 0000011C E3A00001        MOV              r0, #0x01
  188 00000120 EB000008        BL               LCD_cmd     ;send clear LCD dis
                                                            play command 
  189 00000124 E59F021C        LDR              r0, =410
  190 00000128 EBFFFFFE        BL               DELAY
  191 0000012C         
  192 0000012C         ;(8) Send 0x06 command to LCD
  193 0000012C E3A00006        MOV              r0, #0x06
  194 00000130 EB000004        BL               LCD_cmd     ;send entry mode se
                                                            t command 
  195 00000134 E59F020C        LDR              r0, =410
  196 00000138 EBFFFFFE        BL               DELAY
  197 0000013C         
  198 0000013C         ;**Stack stuff     ;ANOTHER METHOD TO RETURN FROM SUBROU
                       TINE
  199 0000013C E8BD0001        LDMFD            SP!, {r0}
  200 00000140 E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  201 00000144 E8BD9FFF        LDMFD            SP!, {r0 - r12, PC} 
                                                            ;restore registers
  202 00000148         
  203 00000148         ;--------------------------------------------------;



ARM Macro Assembler    Page 6 


  204 00000148         ;This subroutine will send a command to the LCD    ;
  205 00000148         ;--------------------------------------------------;
  206 00000148         
  207 00000148         LCD_cmd
  208 00000148         
  209 00000148         ;**Stack stuff
  210 00000148 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  211 0000014C E10F1000        MRS              r1, CPSR    ;preserve status re
                                                            gister
  212 00000150 E92D0002        STMFD            SP!, {r1}
  213 00000154         
  214 00000154         ;(1) D[7:0] = command (passed from the calling program).
                       
  215 00000154         
  216 00000154 E59F21F0        LDR              r2, =IO1PIN ;r2 contains pin da
                                                            ta
  217 00000158         
  218 00000158         ;shift data 
  219 00000158 E1A01800        LSL              r1, r0, #16 ;shift command by 1
                                                            6 bits
  220 0000015C         
  221 0000015C E3A048FF        LDR              r4, =LCD_DATA
  222 00000160 E5925000        LDR              r5,[R2]
  223 00000164 E3E068FF        LDR              R6,=NEG_DATA
  224 00000168 E0055006        AND              r5, r5, r6
  225 0000016C E1813005        ORR              r3, r1, r5  ;mask pins D[0:7] w
                                                            ith command data
  226 00000170 E5823000        STR              r3, [r2]    ;store command to p
                                                            in data
  227 00000174         
  228 00000174         ;(2) RS = 0, R/W = 0, and E = 0 ; and wait for at least 
                       6탎.
  229 00000174         
  230 00000174         ;set RS = 0
  231 00000174 E3A04401        LDR              r4,=LCD_RS
  232 00000178 E59F51C0        LDR              r5,=IO1CLR  ;set P1.24 to zero
  233 0000017C E5854000        STR              r4, [r5]
  234 00000180         
  235 00000180         ;set E = 0
  236 00000180 E3A04402        LDR              r4,=LCD_E
  237 00000184 E59F51B4        LDR              r5,=IO1CLR  ;set P1.25 to zero
  238 00000188 E5854000        STR              r4, [r5]
  239 0000018C         
  240 0000018C         ;set R/W = 0
  241 0000018C E3A04501        LDR              r4, =LCD_RW
  242 00000190 E59F51AC        LDR              r5, =IO0CLR ;set P0.22 to zero
  243 00000194 E5854000        STR              r4, [r5]
  244 00000198         
  245 00000198         ;Wait for 6us
  246 00000198 E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  247 0000019C EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  248 000001A0         
  249 000001A0         ;(3)E = 1 ; and wait for at least 6탎.
  250 000001A0         
  251 000001A0         ;set E = 1
  252 000001A0 E3A04402        LDR              r4,=LCD_E



ARM Macro Assembler    Page 7 


  253 000001A4 E59F51A4        LDR              r5,=IO1SET  ;set P1.25 to one
  254 000001A8 E5854000        STR              r4, [r5]
  255 000001AC         
  256 000001AC         ;Wait for 6us
  257 000001AC E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  258 000001B0 EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  259 000001B4         
  260 000001B4         ;(4) E = 0; and wait for at least 40탎.
  261 000001B4         
  262 000001B4         ;set E = 0
  263 000001B4 E3A04402        LDR              r4,=LCD_E
  264 000001B8 E59F5180        LDR              r5,=IO1CLR  ;set P1.25 to zero
  265 000001BC E5854000        STR              r4, [r5]
  266 000001C0         
  267 000001C0         ;Wait for 40us
  268 000001C0 E3A00004        LDR              r0, =4      ;delay in increment
                                                            s of 10 us  
  269 000001C4 EBFFFFFE        BL               DELAY       ;40e-6 s / 10e-6 s
  270 000001C8         
  271 000001C8         ;**Stack stuff
  272 000001C8 E8BD0001        LDMFD            SP!, {r0}
  273 000001CC E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  274 000001D0 E8BD5FFF        LDMFD            SP!, {r0 - r12, LR} 
                                                            ;restore registers
  275 000001D4         
  276 000001D4 E12FFF1E        BX               LR
  277 000001D8         
  278 000001D8         ;--------------------------------------------------;
  279 000001D8         ;This subroutine will send a char to the LCD       ;
  280 000001D8         ;--------------------------------------------------;
  281 000001D8         
  282 000001D8         LCD_char
  283 000001D8         
  284 000001D8         ;**Stack stuff
  285 000001D8 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  286 000001DC E10F1000        MRS              r1, CPSR    ;preserve status re
                                                            gister
  287 000001E0 E92D0002        STMFD            SP!, {r1}
  288 000001E4         
  289 000001E4         ;(1) D[7:0] = command (passed from the calling program).
                       
  290 000001E4         
  291 000001E4 E59F2160        LDR              r2, =IO1PIN ;r2 contains pin da
                                                            ta
  292 000001E8         
  293 000001E8         ;shift data 
  294 000001E8 E1A01800        LSL              r1, r0, #16 ;shift command by 1
                                                            6 bits
  295 000001EC         
  296 000001EC E3A048FF        LDR              r4, =LCD_DATA
  297 000001F0 E5925000        LDR              r5,[R2]
  298 000001F4 E3E068FF        LDR              R6,=NEG_DATA
  299 000001F8 E0055006        AND              r5, r5, r6
  300 000001FC E1813005        ORR              r3, r1, r5  ;mask pins D[0:7] w
                                                            ith command data



ARM Macro Assembler    Page 8 


  301 00000200 E5823000        STR              r3, [r2]    ;store command to p
                                                            in data
  302 00000204         
  303 00000204         ;(2) RS = 1, R/W = 0, and E = 0 ; and wait for at least 
                       6탎.
  304 00000204         
  305 00000204         ;set RS = 1   ;sets to char mode
  306 00000204 E3A04401        LDR              r4,=LCD_RS
  307 00000208 E59F5140        LDR              r5,=IO1SET  ;set P1.24 to zero
  308 0000020C E5854000        STR              r4, [r5]
  309 00000210         
  310 00000210         ;set E = 0
  311 00000210 E3A04402        LDR              r4,=LCD_E
  312 00000214 E59F5124        LDR              r5,=IO1CLR  ;set P1.25 to zero
  313 00000218 E5854000        STR              r4, [r5]
  314 0000021C         
  315 0000021C         ;set R/W = 0
  316 0000021C E3A04501        LDR              r4, =LCD_RW
  317 00000220 E59F511C        LDR              r5, =IO0CLR ;set P0.22 to zero
  318 00000224 E5854000        STR              r4, [r5]
  319 00000228         
  320 00000228         ;Wait for 60us
  321 00000228 E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  322 0000022C EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  323 00000230         
  324 00000230         ;(3)E = 1 ; and wait for at least 6탎.
  325 00000230         
  326 00000230         ;set E = 1
  327 00000230 E3A04402        LDR              r4,=LCD_E
  328 00000234 E59F5114        LDR              r5,=IO1SET  ;set P1.25 to one
  329 00000238 E5854000        STR              r4, [r5]
  330 0000023C         
  331 0000023C         ;Wait for 60us
  332 0000023C E3A00006        LDR              r0, =6      ;delay in increment
                                                            s of 1 us  
  333 00000240 EBFFFFFE        BL               DELAY       ;6e-6 s / 1e-6 s
  334 00000244         
  335 00000244         ;(4) E = 0; and wait for at least 40탎.
  336 00000244         
  337 00000244         ;set E = 0
  338 00000244 E3A04402        LDR              r4,=LCD_E
  339 00000248 E59F50F0        LDR              r5,=IO1CLR  ;set P1.25 to zero
  340 0000024C E5854000        STR              r4, [r5]
  341 00000250         
  342 00000250         ;Wait for 40us
  343 00000250 E3A00004        LDR              r0, =4      ;delay in increment
                                                            s of 10 us  
  344 00000254 EBFFFFFE        BL               DELAY       ;40e-6 s / 10e-6 s
  345 00000258         
  346 00000258         ;**Stack stuff
  347 00000258 E8BD0001        LDMFD            SP!, {r0}
  348 0000025C E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  349 00000260 E8BD5FFF        LDMFD            SP!, {r0 - r12, LR} 
                                                            ;restore registers
  350 00000264         
  351 00000264 E12FFF1E        BX               LR
  352 00000268         



ARM Macro Assembler    Page 9 


  353 00000268         ;--------------------------------------------------;
  354 00000268         ;This subroutine will clear the LCD          ;
  355 00000268         ;--------------------------------------------------;
  356 00000268         
  357 00000268         LCD_clear
  358 00000268         
  359 00000268         ;**Stack stuff
  360 00000268 E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  361 0000026C E10F0000        MRS              r0, CPSR    ;preserve status re
                                                            gister
  362 00000270 E92D0001        STMFD            SP!, {r0}
  363 00000274         
  364 00000274         ;Call clear command 
  365 00000274 E3A00001        MOV              r0, #0x01
  366 00000278 EBFFFFB2        BL               LCD_cmd
  367 0000027C         
  368 0000027C         ;**Stack stuff
  369 0000027C E8BD0001        LDMFD            SP!, {r0}
  370 00000280 E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  371 00000284 E8BD5FFF        LDMFD            SP!, {r0 - r12, LR} 
                                                            ;restore registers
  372 00000288         
  373 00000288 E12FFF1E        BX               LR
  374 0000028C         
  375 0000028C         ;--------------------------------------------------;
  376 0000028C         ;This subroutine will send a string to the LCD    ;
  377 0000028C         ;--------------------------------------------------;
  378 0000028C         
  379 0000028C         LCD_string
  380 0000028C         
  381 0000028C         ;**Stack stuff
  382 0000028C E92D5FFF        STMFD            SP!, {r0 - r12, LR} 
                                                            ;preserve registers
                                                            
  383 00000290 E10F0000        MRS              r0, CPSR    ;preserve status re
                                                            gister
  384 00000294 E92D0001        STMFD            SP!, {r0}
  385 00000298         
  386 00000298         ;initialize for row 1
  387 00000298         ;ADDRESS OF LCD AND STRING TABLE
  388 00000298         
  389 00000298 E3A01080        LDR              R1, =L1ROW  ;index row 2
  390 0000029C E3A02000        MOV              R2, #0      ;index for string (
                                                            character position)
                                                             
  391 000002A0 E28F305C        ADR              R3, test_string1
  392 000002A4         
  393 000002A4         ROW1
  394 000002A4         ;Fetch first cursor position 
  395 000002A4 E1A00001        MOV              r0, r1
  396 000002A8 EBFFFFA6        BL               LCD_cmd
  397 000002AC         
  398 000002AC         ;Update index after command is called
  399 000002AC E2811001        ADD              R1, r1, #1
  400 000002B0         
  401 000002B0         ;Grab char from string



ARM Macro Assembler    Page 10 


  402 000002B0 E7D20003        LDRB             r0, [r2, r3] ;fetch current cha
                                                            racter
  403 000002B4 E0100000        ANDS             R0,R0,R0    ;check for end of s
                                                            tring
  404 000002B8 0A000002        BEQ              NEXTROW     ;If end of string i
                                                            s reached, move to 
                                                            next row
  405 000002BC EBFFFFC5        BL               LCD_char    ;call char command
  406 000002C0         
  407 000002C0 E2822001        ADD              r2, r2, #1  ;fetch next charact
                                                            er of string
  408 000002C4         
  409 000002C4 EAFFFFF6        B                ROW1
  410 000002C8         
  411 000002C8         NEXTROW
  412 000002C8         
  413 000002C8         ;initialize for row 2
  414 000002C8         ;ADDRESS OF LCD AND STRING TABLE
  415 000002C8         
  416 000002C8 E3A010C0        LDR              R1, =L2ROW  ;index of cursor po
                                                            sition
  417 000002CC E3A02000        MOV              R2, #0      ;index for string (
                                                            character position)
                                                            
  418 000002D0 E28F3039        ADR              R3, test_string2
  419 000002D4         
  420 000002D4         ROW2
  421 000002D4         ;Fetch first cursor position 
  422 000002D4 E1A00001        MOV              r0, r1
  423 000002D8 EBFFFF9A        BL               LCD_cmd
  424 000002DC         
  425 000002DC         ;Update index after command is called
  426 000002DC E2811001        ADD              R1, r1, #1
  427 000002E0         
  428 000002E0         ;Same process as row1
  429 000002E0 E7D20003        LDRB             r0, [r2, r3]
  430 000002E4 E0100000        ANDS             R0,R0,R0
  431 000002E8 0A000002        BEQ              DONE
  432 000002EC EBFFFFB9        BL               LCD_char
  433 000002F0         
  434 000002F0 E2822001        ADD              r2, r2, #1  ;fetch next charact
                                                            er of string
  435 000002F4         
  436 000002F4 EAFFFFF6        B                ROW2
  437 000002F8         
  438 000002F8         DONE
  439 000002F8         
  440 000002F8         ;**Stack stuff
  441 000002F8 E8BD0001        LDMFD            SP!, {r0}
  442 000002FC E128F000        MSR              CPSR_f, r0  ;restore status reg
                                                            ister flags
  443 00000300 E8BD9FFF        LDMFD            SP!, {r0 - r12, PC} 
                                                            ;restore registers
  444 00000304         
  445 00000304 48 65 6C 
              6C 6F 20 
              57 6F 72 
              6C 64 2E 
              00       test_string1



ARM Macro Assembler    Page 11 


                               DCB              "Hello World.", 0
  446 00000311 49 74 27 
              73 20 41 
              6C 69 76 
              65 21 00 test_string2
                               DCB              "It's Alive!", 0
  447 0000031D 00 00 00        ALIGN
  448 00000320         
  449 00000320                 END
              E002C004 
              30003000 
              E002C014 
              E0028008 
              40400000 
              E0028018 
              03FF0000 
              E0028004 
              E002801C 
              E002800C 
              0000019A 
              E0028010 
              E0028014 
Command Line: --debug --xref --diag_suppress=9931 --apcs=interwork --depend=.\o
bjects\lab9.d -o.\objects\lab9.o -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMS
IS\Include -IC:\Keil_v5\ARM\INC\Philips --predefine="__EVAL SETA 1" --predefine
="__UVISION_VERSION SETA 524" --list=.\listings\lab9.lst lab9.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

DONE 000002F8

Symbol: DONE
   Definitions
      At line 438 in file lab9.s
   Uses
      At line 431 in file lab9.s
Comment: DONE used once
LCD_char 000001D8

Symbol: LCD_char
   Definitions
      At line 282 in file lab9.s
   Uses
      At line 405 in file lab9.s
      At line 432 in file lab9.s

LCD_clear 00000268

Symbol: LCD_clear
   Definitions
      At line 357 in file lab9.s
   Uses
      None
Comment: LCD_clear unused
LCD_cmd 00000148

Symbol: LCD_cmd
   Definitions
      At line 207 in file lab9.s
   Uses
      At line 158 in file lab9.s
      At line 164 in file lab9.s
      At line 170 in file lab9.s
      At line 176 in file lab9.s
      At line 182 in file lab9.s
      At line 188 in file lab9.s
      At line 194 in file lab9.s
      At line 366 in file lab9.s
      At line 396 in file lab9.s
      At line 423 in file lab9.s

LCD_init 00000094

Symbol: LCD_init
   Definitions
      At line 128 in file lab9.s
   Uses
      At line 67 in file lab9.s
Comment: LCD_init used once
LCD_pins 00000024

Symbol: LCD_pins
   Definitions
      At line 80 in file lab9.s
   Uses
      At line 64 in file lab9.s
Comment: LCD_pins used once
LCD_string 0000028C



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols


Symbol: LCD_string
   Definitions
      At line 379 in file lab9.s
   Uses
      At line 69 in file lab9.s
Comment: LCD_string used once
NEXTROW 000002C8

Symbol: NEXTROW
   Definitions
      At line 411 in file lab9.s
   Uses
      At line 404 in file lab9.s
Comment: NEXTROW used once
ROW1 000002A4

Symbol: ROW1
   Definitions
      At line 393 in file lab9.s
   Uses
      At line 409 in file lab9.s
Comment: ROW1 used once
ROW2 000002D4

Symbol: ROW2
   Definitions
      At line 420 in file lab9.s
   Uses
      At line 436 in file lab9.s
Comment: ROW2 used once
lcd_subs 00000000

Symbol: lcd_subs
   Definitions
      At line 56 in file lab9.s
   Uses
      At line 48 in file lab9.s
Comment: lcd_subs used once
mycode 00000000

Symbol: mycode
   Definitions
      At line 49 in file lab9.s
   Uses
      None
Comment: mycode unused
test_string1 00000304

Symbol: test_string1
   Definitions
      At line 445 in file lab9.s
   Uses
      At line 391 in file lab9.s
Comment: test_string1 used once
test_string2 00000311

Symbol: test_string2
   Definitions



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Relocatable symbols

      At line 446 in file lab9.s
   Uses
      At line 418 in file lab9.s
Comment: test_string2 used once
14 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

IO0CLR E002800C

Symbol: IO0CLR
   Definitions
      At line 22 in file lab9.s
   Uses
      At line 149 in file lab9.s
      At line 242 in file lab9.s
      At line 317 in file lab9.s

IO0DIR E0028008

Symbol: IO0DIR
   Definitions
      At line 12 in file lab9.s
   Uses
      At line 99 in file lab9.s
Comment: IO0DIR used once
IO0DIROUT 40400000

Symbol: IO0DIROUT
   Definitions
      At line 16 in file lab9.s
   Uses
      At line 101 in file lab9.s
Comment: IO0DIROUT used once
IO0PIN E0028000

Symbol: IO0PIN
   Definitions
      At line 25 in file lab9.s
   Uses
      None
Comment: IO0PIN unused
IO0SET E0028004

Symbol: IO0SET
   Definitions
      At line 20 in file lab9.s
   Uses
      At line 114 in file lab9.s
Comment: IO0SET used once
IO1CLR E002801C

Symbol: IO1CLR
   Definitions
      At line 23 in file lab9.s
   Uses
      At line 139 in file lab9.s
      At line 144 in file lab9.s
      At line 232 in file lab9.s
      At line 237 in file lab9.s
      At line 264 in file lab9.s
      At line 312 in file lab9.s
      At line 339 in file lab9.s

IO1DIR E0028018

Symbol: IO1DIR



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 13 in file lab9.s
   Uses
      At line 106 in file lab9.s
Comment: IO1DIR used once
IO1DIROUT 03FF0000

Symbol: IO1DIROUT
   Definitions
      At line 17 in file lab9.s
   Uses
      At line 108 in file lab9.s
Comment: IO1DIROUT used once
IO1PIN E0028010

Symbol: IO1PIN
   Definitions
      At line 26 in file lab9.s
   Uses
      At line 216 in file lab9.s
      At line 291 in file lab9.s

IO1SET E0028014

Symbol: IO1SET
   Definitions
      At line 21 in file lab9.s
   Uses
      At line 253 in file lab9.s
      At line 307 in file lab9.s
      At line 328 in file lab9.s

L1ROW 00000080

Symbol: L1ROW
   Definitions
      At line 40 in file lab9.s
   Uses
      At line 389 in file lab9.s
Comment: L1ROW used once
L2ROW 000000C0

Symbol: L2ROW
   Definitions
      At line 41 in file lab9.s
   Uses
      At line 416 in file lab9.s
Comment: L2ROW used once
LCD_DATA 00FF0000

Symbol: LCD_DATA
   Definitions
      At line 29 in file lab9.s
   Uses
      At line 221 in file lab9.s
      At line 296 in file lab9.s

LCD_E 02000000




ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

Symbol: LCD_E
   Definitions
      At line 31 in file lab9.s
   Uses
      At line 143 in file lab9.s
      At line 236 in file lab9.s
      At line 252 in file lab9.s
      At line 263 in file lab9.s
      At line 311 in file lab9.s
      At line 327 in file lab9.s
      At line 338 in file lab9.s

LCD_LIGHT 40000000

Symbol: LCD_LIGHT
   Definitions
      At line 33 in file lab9.s
   Uses
      At line 113 in file lab9.s
Comment: LCD_LIGHT used once
LCD_RS 01000000

Symbol: LCD_RS
   Definitions
      At line 30 in file lab9.s
   Uses
      At line 138 in file lab9.s
      At line 231 in file lab9.s
      At line 306 in file lab9.s

LCD_RW 00400000

Symbol: LCD_RW
   Definitions
      At line 32 in file lab9.s
   Uses
      At line 148 in file lab9.s
      At line 241 in file lab9.s
      At line 316 in file lab9.s

NEG_DATA FF00FFFF

Symbol: NEG_DATA
   Definitions
      At line 37 in file lab9.s
   Uses
      At line 223 in file lab9.s
      At line 298 in file lab9.s

NEG_LIGHT BFFFFFFF

Symbol: NEG_LIGHT
   Definitions
      At line 36 in file lab9.s
   Uses
      None
Comment: NEG_LIGHT unused
PINSEL0 E002C000




ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Absolute symbols

Symbol: PINSEL0
   Definitions
      At line 3 in file lab9.s
   Uses
      None
Comment: PINSEL0 unused
PINSEL1 E002C004

Symbol: PINSEL1
   Definitions
      At line 4 in file lab9.s
   Uses
      At line 88 in file lab9.s
Comment: PINSEL1 used once
PINSEL1GPIO 30003000

Symbol: PINSEL1GPIO
   Definitions
      At line 8 in file lab9.s
   Uses
      At line 90 in file lab9.s
Comment: PINSEL1GPIO used once
PINSEL2 E002C014

Symbol: PINSEL2
   Definitions
      At line 5 in file lab9.s
   Uses
      At line 94 in file lab9.s
Comment: PINSEL2 used once
PINSEL2GPIO 00000008

Symbol: PINSEL2GPIO
   Definitions
      At line 9 in file lab9.s
   Uses
      None
Comment: PINSEL2GPIO unused
R1ROW 0000008F

Symbol: R1ROW
   Definitions
      At line 44 in file lab9.s
   Uses
      None
Comment: R1ROW unused
25 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

DELAY 00000000

Symbol: DELAY
   Definitions
      At line 47 in file lab9.s
   Uses
      At line 154 in file lab9.s
      At line 160 in file lab9.s
      At line 166 in file lab9.s
      At line 172 in file lab9.s
      At line 178 in file lab9.s
      At line 184 in file lab9.s
      At line 190 in file lab9.s
      At line 196 in file lab9.s
      At line 247 in file lab9.s
      At line 258 in file lab9.s
      At line 269 in file lab9.s
      At line 322 in file lab9.s
      At line 333 in file lab9.s
      At line 344 in file lab9.s

1 symbol
374 symbols in table
